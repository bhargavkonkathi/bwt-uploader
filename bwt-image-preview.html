<link rel="import" href="bwt-upload-mixin.html">
<dom-module id="bwt-image-preview">
    <template>
    <style is="custom-style">
      :host {
        display: block;
      }

      .template-div-droptext>span {
        text-align: center;
      }

      .template-div-droptext span:nth-child(2) {
        text-align: left;
        font-weight: 400;
      }

      .imageCircleContainer,
      .imageSquareContainer {
        order: 1;
        flex: wrap;
        border: var(--preview-border, 1px dashed #dbdbdb);
        overflow: hidden;
        width: var(--preview-width, 250px);
        height: var(--preview-height, 250px);
      }

      .img {
        height: inherit;
        width: inherit;
        display: block;
      }

      .imageCircleContainer {
        border-radius: 100%;
      }

      .imageCircleContainer>div {
        background-size: cover !important;
      }

      .customContainer {
        width: var(--preview-width-custom-class, 250px);
        height: var(--preview-height-custom-class, 250px);
        order: 1;
        flex: wrap;
        border: var(--preview-border, 1px dashed #dbdbdb);
        overflow: hidden;
      }

      .customContainer>.img {
        width: var(--preview-width-custom-class, 250px);
        height: var(--preview-height-custom-class, 250px);
      }
    </style>

    <div class$="[[className]]">
      <div class="img" style$="background: url('[[image]]') no-repeat center center;"></div>
    </div>
  </template>
    <script>
        /**
         * `LowerCaseDashedName` Description
         *
         * @summary ShortDescription.
         * @customElement
         * @polymer
         * @extends {Polymer.Element}
         */
        class BWTImagePreview extends Polymer.Element { //BWTUploadMixin
            /**
             * String providing the tag name to register the element under.
             */
            static get is() {
                return 'bwt-image-preview';
            }

            /**
             * Object describing property-related metadata used by Polymer features
             */
            static get properties() {
                return {
                    className: {
                        type: String,
                        notify: true
                    },
                    theme: {
                        type: String,
                        value: 'cricle'
                    },
                    placeholder: {
                        type: String,
                        value: '/images/placeholder.png'
                    }
                };
            }

            static get observers() {
                return [
                    '_updateImage(placeholder,image)',
                    '_generateClassNames(theme,image,placeholder)'
                ];
            }

            /**
             * Instance of the element is created/upgraded. Use: initializing state,
             * set up event listeners, create shadow dom.
             * @constructor
             */
            constructor() {
                super();
            }

            /**
             * Use for one-time configuration of your component after local DOM is initialized. 
             */
            ready() {
                super.ready();

                Polymer.RenderStatus.afterNextRender(this, function() {

                });
            }

            _generateClassNames(theme, image, placeholder) {
                if (image && (image.length === placeholder.length)) {
                    if (theme === 'square') this.className = 'imageSquareContainer';
                    else this.className = 'imageCircleContainer';
                } else if (image == '') {
                    if (theme == 'square') this.className = 'imageSquareContainer';
                    else this.className = 'imageCircleContainer';
                } else if (this.customClass) {
                    this.className = 'customContainer';
                }
            }
            _updateImage(placeholder, image) {
                this.image = (placeholder && image) ? image : placeholder;
                this.error = null;
            }
            _createImagePreview(file, b64) {
                file.progress = 40;
                this.notifyPath('file.progress');
                var fr = new FileReader();
                return new Promise(function(resolve, reject) {
                    fr.onload = function(e) {
                        var image = e.target.result;
                        this.image = image;
                        resolve(image);
                    }.bind(this);
                    fr.readAsDataURL(file);
                }.bind(this));
            }
        }

        window.customElements.define(BWTImagePreview.is, BWTImagePreview);
    </script>
</dom-module>